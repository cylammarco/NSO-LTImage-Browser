<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="image/x-icon" rel="shortcut icon" href="./favicon.ico">
    <link type="text/css" rel="stylesheet" href="stylesheets/style.css">
    <link type="text/css" rel="stylesheet" href="javascripts/js9/js9support.css">
    <link type="text/css" rel="stylesheet" href="javascripts/js9/js9.css">
    <link rel="apple-touch-icon" href="images/js9-apple-touch-icon.png">
    <script type="text/javascript" src="javascripts/js9/js9prefs.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9support.min.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9.min.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9plugins.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9usermenus.js"></script>
    <style type="text/css">
      #centerdiv {
      position: absolute;
      margin: auto;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      width: 512px;
      height: 512px;
      }
    </style>
    <title>JS9</title>
  </head>
  <body>
    <center>
      NGC 1530 FITS files:
      <input type="button" id="red" value="IO:O, SDSS-r" onclick="javascript:loadim('h_e_20170203_15_1_1_1.fits', 'red')">
      <input type="button" id="green" value="IO:O, SDSS-g" onclick="javascript:loadim('h_e_20170203_16_1_1_1.fits', 'green')">
      <input type="button" id="blue" value="IO:O, Bessel-B" onclick="javascript:loadim('h_e_20170203_17_1_1_1.fits', 'blue')">
      <p>
      <div class="JS9Menubar"></div>
      <p>
      <table>
        <tr valign="top">
          <td>
            <div class="JS9" id="JS9" data-width="600px" data-height="600px"></div>
          </td>
          <td>
            <table>
              <tr>
                <div class="JS9" id="redChannel" data-width="200px" data-height="200px"></div>
              </tr>
              <tr>
                <div class="JS9" id="greenChannel" data-width="200px" data-height="200px"></div>
              </tr>
              <tr>
                <div class="JS9" id="blueChannel" data-width="200px" data-height="200px"></div>
              </tr>
              </td>
            </table>
        </tr>
        <p>
      </table>
    </center>
    <script type="text/javascript">
      JS9.AddColormap("red", [[0,0],[1,1]], [[0,0],[0,0]], [[0,0],[0,0]]);
      JS9.AddColormap("green", [[0,0],[0,0]], [[0,0],[1,1]], [[0,0],[0,0]]);
      JS9.AddColormap("blue", [[0,0],[0,0]], [[0,0],[0,0]], [[0,0],[1,1]]);
      
      var ropts = {};
      var xdir = "images/";
      var loaded = [false, false, false, false];
      var reprojed = [false, false, false, false];
      var sigma = 1;
      
      function init(){
          $('#blur').prop('selectedIndex', 0);
          $('#blend').prop('selectedIndex', 0);
          $('#opacity').prop('selectedIndex', 0);
      }
      
      function loadim(s, colour){
          var idx = -1;
          var file = s;
          console.log("loading: %s", file)
          opts = {colormap: colour, scale: "log", contrast: "4.5", bias: "0.4", zoom: "0.5", parentFile:"fits/"+file, onload: function(im) {
          JS9.BlendDisplay(true);
          JS9.BlendImage(true);
          JS9.BlendImage("screen", 0.8);
        }}
          JS9.Load(xdir+file, opts, {display: colour+"Channel"});
          JS9.Load(xdir+file, opts, {display: "JS9"});
      }
      
      function reproject(){
        var im = JS9.GetImage();
        for(i=0; i<loaded.length; i++){
            if( loaded[i] && (loaded[i] !== im) && (reprojed[i] === false) ){
              console.log("reprojecting %d: %s using %s", i, loaded[i], im.id);
              loaded[i].reprojectData(im, ropts);
        reprojed[i] = true;
            }
        }       
      }
      
      function xblur(target){
        var im = JS9.GetImage();
        var sigma = target.options[target.selectedIndex].value;
        if( im && sigma !== "" ){
          console.log("blur: %s %s", im.id, sigma);
          im.gaussBlurData(parseFloat(sigma));
        }
      }
      
      function xblend(target){
        var im = JS9.GetImage();
        var blend = target.options[target.selectedIndex].value;
        if( im && blend !== "" ){
            im.blendImage(blend);
        }
      }
      
      function xopacity(target){
        var im = JS9.GetImage();
        var opacity = target.options[target.selectedIndex].value;
        if( im && opacity !== "" ){
          im.blendImage(null, opacity);
        }
      }
      
      function toggle(){
          blendMode = !blendMode;
          JS9.BlendDisplay(blendMode);
          $("#blendstr").html(blendMode ? "<b>on<\/b>" : "<b>off<\/b>");
      }
      
    </script>
  </body>
</html>

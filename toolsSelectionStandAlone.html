<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="image/x-icon" rel="shortcut icon" href="./favicon.ico">
    <link type="text/css" rel="stylesheet" href="javascripts/js9/js9support.css">
    <link type="text/css" rel="stylesheet" href="javascripts/js9/js9.css">
    <link rel="apple-touch-icon" href="images/js9-apple-touch-icon.png">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9prefs.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9support.min.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9.min.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9plugins.js"></script>
    <script type="text/javascript" src="javascripts/js9/js9usermenus.js"></script>
    <script type="text/javascript" src="javascripts/js9nso.js"></script>
    <script type="text/javascript" src="javascripts/bootstrap-checkbox/dist/js/bootstrap-checkbox.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.css">
    <link type="text/css" rel="stylesheet" href="stylesheets/style.css">
    <title>JS9</title>
  </head>
  <body>
    <table cellpadding="10">
      Please select the tools you would like to include in your environment:
      <tr>
        <td>
          </br>
        </td>
      </tr>
      <tr>
        <td>
          Menu Bar
        </td>
        <td>
          <input class="checkbox-option default-true" id="menubar" type="checkbox" checked>
        </td>
      </tr>
      <tr>
        <td>
          Magnifier Viewer
        </td>
        <td>
          <input class="checkbox-option default-false" id="magnifierviewer" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          zmin/zmax
        </td>
        <td>
          <input class="checkbox-option default-false" id="zminmax" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Distance
        </td>
        <td>
          <input class="checkbox-option default-false" id="distancetools" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Region
        </td>
        <td>
          <input class="checkbox-option default-false" id="regiontools" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Region Statistics
        </td>
        <td>
          <input class="checkbox-option default-false" id="regionstats" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Radial Profile
        </td>
        <td>
          <input class="checkbox-option default-false" id="radialprofile" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Histogram
        </td>
        <td>
          <input class="checkbox-option default-false" id="histogram" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Encircled Energy
        </td>
        <td>
          <input class="checkbox-option default-false" id="energy" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Blink
        </td>
        <td>
          <input class="checkbox-option default-false" id="blink" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          Header
        </td>
        <td>
          <input class="checkbox-option default-false" id="header" type="checkbox">
        </td>
      </tr>
      <tr>
        <td>
          </br>
        </td>
      </tr>
      <tr>
        <td>
          <input class="btn btn-default" value="Load RGB Staphen's Quintet in grey" onclick="javascript:loadim()">
        </td>
        <td>
          <input class="btn btn-default" value="Reset" onclick="javascript:resetForm()">
        </td>
      </tr>
    </table>
    </br>
    <div class="JS9Menubar" id='SUPERMENU_Menubar' data-displays="*" data-width="600px"></div>
    <table>
      <tr>
        <td>
          <div class="JS9Displays">
            <div class="JS9" id="JS9" data-width="600px" data-height="600px"></div>
          </div>
        </td>
        <td>
          <div class="JS9Magnifier"></div>
        </td>
      </tr>
    </table>
    </br>
    <table>
      <!--  Brightness & Contrast -->
      <tr>
        <input class="btn btn-default" id='tilebutton' value="Tile" onclick="javascript:tiledisplay('JS9')">
        <input class="btn btn-default" id='gatherbutton' value="Gather" onclick="javascript:gatherdisplay('JS9')">
      </tr>
      <tr>
        <td>
          <div>
            <label class='label file'>Load File<input id='inputfile' type='file'></label>
          </div>
        </td>
      </tr>
      <tr>
        <div class="zminmaxslidercontainer" data-js9id="JS9">
          z-min <input type="range" min="0" max="48165" value="0" class="slider zMin" id='zMin'></input>
          z-max<input type="range" min="0" max="48165" value="48165" class="slider zMax" id='zMax'></input>
        </div>
      </tr>
    </table>
    <div class="ImexamContainer">
      <table cellpadding="5" cellspacing="8">
        <tr>
          </br>
          <div class="distancebox">
            <input class="btn btn-default region" value="Add a Line" id="line" data-js9id="JS9">
            <div class="lineWidth"></div>
            <div class="lineHeight"></div>
            <div class="lineDistance"></div>
          </div>
        </tr>
        <tr>
          <div class="regionbox">
            Choose the shape of the aperture for photometry:
            <input class="btn btn-default region" value="Circle" id="circle" data-js9id="JS9">
            <input class="btn btn-default region" value="Box" id="box" data-js9id="JS9">
            <input class="btn btn-default region" value="Ellipse" id="ellipse" data-js9id="JS9">
          </div>
        </tr>
        <tr>
          <td>
            <div class="ImExamRegionStats" data-js9id="JS9"></div>
          </td>
          <td>
            <div class="ImExamRadialProj" data-js9id="JS9"></div>
          </td>
          <td>
            <div class="ImExamHistogram" data-js9id="JS9"></div>
          </td>
          <td>
            <div class="ImExamEncEnergy" data-js9id="JS9"></div>
          </td>
        </tr>
      </table>
    </div>
    <table>
      <tr>
        <div class="JS9Info" data-js9id="JS9" data-width="325px"></div>
      </tr>
      <tr>
        <div id="blinkController">
          Start and Stop Blinking -> <input class="blinkStatus" type="checkbox" data-reverse>
          <br>
          Blink rate: <button type="button" class="buttonMinus">-</button><button type="button" class="buttonPlus">+</button>
        </div>
      </tr>
      <tr>
        <div id='save640'>
          <input class="btn btn-default" value="Save As PNG (640px)" onclick="javascript:mySaveIMG('PNG', 640)">
          <input class="btn btn-default" value="Save As JPG (640px)" onclick="javascript:mySaveIMG('JPG', 640)">
        </div>
      </tr>
      <tr>
        <div id='save1024'>
          <input class="btn btn-default" value="Save As PNG (1024px)" onclick="javascript:mySaveIMG('PNG', 1024)">
          <input class="btn btn-default" value="Save As JPG (1024px)" onclick="javascript:mySaveIMG('JPG', 1024)">
        </div>
      </tr>
      <tr>
        <div id='save2048'>
          <input class="btn btn-default" value="Save As PNG (2048px)" onclick="javascript:mySaveIMG('PNG', 2048)">
          <input class="btn btn-default" value="Save As JPG (2048px)" onclick="javascript:mySaveIMG('JPG', 2048)">
        </div>
      </tr>
    </table>
    <script type="text/javascript">

      /* Enabling bootstrap checkbox
       * https://github.com/vsn4ik/bootstrap-checkbox
       */
      $(':checkbox').checkboxpicker();

      function init() {
        var blinkrate = NSO.blinkrate;
        var blinkModeOn = NSO.blinkMode;
        // a loop to load all files into the display:
        document.getElementById('blinkController').style.display = "none";
        document.getElementById('save640').style.display = "none";
        document.getElementById('save1024').style.display = "none";
        document.getElementById('save2048').style.display = "none";
        document.getElementsByClassName('distancebox')[0].style.display = "none";
        document.getElementsByClassName('JS9Magnifier')[0].style.display = "none";
        document.getElementsByClassName('zminmaxslidercontainer')[0].style.display = "none";
        document.getElementsByClassName('JS9PluginToolbar-div')[0].style.display = "none";
        document.getElementsByClassName('regionbox')[0].style.display = "none";
        document.getElementsByClassName('JS9Info')[0].style.display = "none";
        document.getElementsByClassName('ImExamRegionStats')[0].parentNode.style.display = "none";
        document.getElementsByClassName('ImExamRadialProj')[0].parentNode.style.display = "none";
        document.getElementsByClassName('ImExamHistogram')[0].parentNode.style.display = "none";
        document.getElementsByClassName('ImExamEncEnergy')[0].parentNode.style.display = "none";
      }

      $(document).ready(function () {
        init();
      });

      /* Reset the page by changing all checkbox to default and
       * removes all loaded images
       */
      function resetForm() {
        $(".default-true").prop('checked', true);
        $(".default-false").prop('checked', false);
        JS9.CloseDisplay('JS9');
        blinkinterval = NSO.blinkInterval;
      }

      $('#menubar').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('JS9Menubar')[0];
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });
      
      $('#magnifierviewer').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('JS9Magnifier')[0];
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        }
        else {
          e.style.display = "none";
        }
      });

      $('#zminmax').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('zminmaxslidercontainer')[0];
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        }
        else {
          e.style.display = "none";
        }
      });

      $('#distancetools').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('distancebox')[0];
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $('#regiontools').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('regionbox')[0];
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $('#regionstats').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('ImExamRegionStats')[0].parentNode;
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $('#radialprofile').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('ImExamRadialProj')[0].parentNode;
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $('#histogram').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('ImExamHistogram')[0].parentNode;
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $('#energy').checkboxpicker().on('change', function () {
        e = document.getElementsByClassName('ImExamEncEnergy')[0].parentNode;
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $('#blink').checkboxpicker().on('change', function () {
        e = document.getElementById('blinkController');
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $('#header').checkboxpicker().on('change', function () {
        e = document.getElementById('JS9Info');
        if (e.style.display == null || e.style.display == "none") {
          e.style.display = "block";
        } else {
          e.style.display = "none";
        }
      });

      $(".region").on('click', function (evt) {
        var s = $(evt.currentTarget).attr("id");
        JS9.AddRegions(s);
      });

      JS9.Regions.opts.onchange = function () {
        l = JS9.GetRegionStats(JS9.GetRegions()[0]).reg.pts;
        lw = l[1].x - l[0].x;
        lh = l[1].y - l[0].y;
        llen = Math.sqrt(Math.pow(lw,2) + Math.pow(lh,2));
        lw = Math.round(lw*100) / 100;
        lh = Math.round(lh*100) / 100;
        llen = Math.round(llen*100) / 100;
        $(".lineWidth").html("Width = " + Math.abs(lw));
        $(".lineHeight").html("Height = " + Math.abs(lh));
        $(".lineDistance").html("Distance = " + Math.abs(llen));
      }

      /* Selecting the brightness and contrast sliders */
      var zMinRange = document.getElementById('zMin');
      var zMaxRange = document.getElementById('zMax');

      /* Get the current brightness and contrast values from the sliders*/
      var zMin = parseFloat(zMinRange.value);
      var zMax = parseFloat(zMaxRange.value);

      zMinRange.addEventListener('input', function () {
        zMin = parseFloat(this.value);
        updateZMin(zMinRange, zMaxRange, zMin);
      });
      zMaxRange.addEventListener('input', function () {
        zMax = parseFloat(this.value);
        updateZMax(zMinRange, zMaxRange, zMax);
      });

      /* Increase the blink rate / Decrease the blink interval */
      $(".buttonPlus").on("click", function() {
        if (blinkinterval > NSO.minBlinkInterval) {
          blinkinterval /= 2;
        }
      });

      /* Decrease the blink rate / Increase the blink interval */
      $(".buttonMinus").on("click", function() {
        if (blinkinterval < NSO.maxBlinkInterval) {
          blinkinterval *= 2;
        }
      });

      $('.blinkStatus').checkboxpicker().on('change', function () {
        if (blinkModeOn == false) {
          blinkModeOn = true;
        } else {
          blinkModeOn = false;
        }
        blinkfunc();
      });

      function loadim() {
        resetForm();
        var files = NSO.exampleFiles;
        opts1 = {
            ...NSO.imgOpts,
            ...{
            parentFile: "fits/" + files[0],
            colormap: "grey"
            }
          };
        opts2 = {
            ...NSO.imgOpts,
            ...{
            parentFile: "fits/" + files[1],
            colormap: "grey"
            }
          };
        opts3 = {
            ...NSO.imgOpts,
            ...{
            parentFile: "fits/" + files[2],
            colormap: "grey"
            }
          };
        opts = [opts1, opts2, opts3]

        // a loop to load all files into the display:
        for (var i = 0; i < files.length; i++) {
          var thisfilename = files[i];
          JS9.Load("images/" + thisfilename, opts[i]);
        }
      }

      /* Load files on local machine */
      var inputfile = document.querySelector('#inputfile');
      inputfile.addEventListener('change', readURL);

      function readURL() {
        opts = {
          ...NSO.imgOpts,
          ...{
            colormap: "grey",
            parentFile: "fits/" + input.name
          }
        };
        JS9.Load(input, opts);
      }

    </script>
  </body>
</html>
